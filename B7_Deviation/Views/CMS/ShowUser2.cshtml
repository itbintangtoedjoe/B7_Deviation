
@{
    ViewBag.Title = "ShowUser";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/Styles/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/Content/Styles/js/jquery.dataTables.min.js" defer></script>

<!DOCTYPE html>
<html lang="en">
<body>
    <div class="content-body">

        <div class="container-fluid">
            <div class="card">
                <div class="card-body">
                    <h1>List of Users</h1>

                    <a href="/CMS/InputForm" class="btn btn-primary">Add User</a>

                    <hr />

                    <table class="table table-striped table-bordered zero-configuration nowrap table-responsive" width="100%" id="datatableuser">
                        <thead>
                            <tr>
                                <th hidden="hidden"></th>
                                <th>Employee ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Employee Name</th>
                                <th>Job Name</th>
                                <th>Superior ID</th>
                                <th>Superior Name</th>
                                <th>Department</th>
                                <th>Superior Email</th>
                                <th>Role Deviation</th>
                                <th>Kategori Penyimpangan</th>
                                <th>Actions</th>
                                <th>Reset Password</th>
                                <th hidden="hidden">Type</th>

                            </tr>
                        </thead>
                        <tbody id="usertable" class="nowrap">
                        </tbody>
                    </table>


                    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Edit User: <label id="nama"></label></h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="username" class="col-form-label">
                                                Username :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="username" type="text" style="display:block;" name="username" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="email" class="col-form-label">
                                                Email :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="email" type="text" style="display:block;" name="email" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="name" class="col-form-label">
                                                Name :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="name" type="text" style="display:block;" name="name" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="job" class="col-form-label">
                                                Job Name :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="job" type="text" style="display:block;" name="job" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="ddlsuperiorname" class="col-form-label">
                                                Superior Name :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select id="ddlsuperiorname" class="form-control">
                                                <option value="" class="dropdown-header" selected>Select Superior Name</option>
                                                <option id="vspv"></option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="spvid" class="col-form-label">
                                                Superior ID :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="spvid" type="text" style="display:block;" name="spvid" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="dept" class="col-form-label">
                                                Department :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="dept" type="text" style="display:block;" name="dept" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="spvemail" class="col-form-label">
                                                Superior Email :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <input class="form-control" id="spvemail" type="text" style="display:block;" name="spvemail" />
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="role" class="col-form-label">
                                                Deviation Role :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select id="role" class="form-control">
                                                <option value="" class="dropdown-header" selected>Select Role</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row form-group">
                                        <div class="col-lg-4 col-form-label" style="text-align:right;">
                                            <label for="penyimpangan" class="col-form-label">
                                                Kategori Penyimpangan :
                                            </label>
                                        </div>
                                        <div class="col-lg-6">
                                            <select id="penyimpangan" class="form-control js-example-basic-multiple"  style="width: 350px;">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="Update">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>



</body>
</html>
<script>
    $(document).ready(function () {
        // Load User once the page is loaded
        LoadUser();

        $("#ddlsuperiorname").change(function () {

            var spvid = $("#ddlsuperiorname").val();
            GetSuperiorVendorDetail(spvid);
        });



    });

    function GetSuperiorVendorDetail(spvid) {

        var dto = {
            Empid: spvid
        }

        $.ajax({
            url: "../CMS/CMS_LoadSuperiorVendorDetail",
            type: "post",
            data: JSON.stringify(dto),
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                alert(data[0].orggroupname);

                $("#spvid").val(spvid);
                $("#dept").val(data[0].orggroupname);
                $("#spvemail").val(data[0].email);
            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }


    function GetSuperiornameDDL(id) {
        var dto = {
            Empid: id
        }

        $.ajax({
            url: "../CMS/CMS_LoadVendorSuperiornameDDL",
            type: "post",
            data: JSON.stringify(dto),
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                var trhtml = "";
                var trav = 0;
                var count = data.length;
                trhtml += '<option disabled selected class="dropdown-header">* Select Superior Name *</option>';

                if (count > 0) {
                    for (trav = 0; trav < count; trav++) {

                        if (data[trav].O_SPVVENDOR_ID == data[trav].SPVVENDOR_ID) {
                            trhtml +=
                                '<Option class="dropdown-item" selected value = "' + data[trav].O_SPVVENDOR_ID + '" > ' + data[trav].O_SPVVENDOR_NAME;
                        } else {
                            trhtml +=
                                '<Option class="dropdown-item" value = "' + data[trav].O_SPVVENDOR_ID + '" > ' + data[trav].O_SPVVENDOR_NAME;
                        }


                    }
                }

                $("#ddlsuperiorname").empty();
                $("#ddlsuperiorname").append(trhtml);
                $("#ddlsuperiorname").select();


            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function Reset(button) {
        var row = $(button).closest("TR");

        var id = $("TD", row).eq(1).html();
        var name = $("TD", row).eq(4).html();

        var dto = {
            Empid: id
        }

        $.ajax({
            url: "../CMS/CMS_ResetPasswordVendor",
            type: "post",
            data: JSON.stringify(dto),
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: 'Reset Password: ' + name + ', Success!'
                });

                LoadUser();

            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });

    }


    function Edit(button) {


        var row = $(button).closest("TR");

        var id = $("TD", row).eq(1).html();

        var username = $("TD", row).eq(2).html();
        var email = $("TD", row).eq(3).html();
        var name = $("TD", row).eq(4).html();
        var job = $("TD", row).eq(5).html();
        var spvid = $("TD", row).eq(6).html();
        var spvname = $("TD", row).eq(7).html();
        var dept = $("TD", row).eq(8).html();
        var spvemail = $("TD", row).eq(9).html();
        var type = $("TD", row).eq(14).html();

        var text = "";


        GetKategoriPenyimpangan(username);
        GetRoleEdit(username);

        // JUDUL
        $("#nama").text(name);

        // ISI
        $("#username").val(username);
        $("#username").attr("disabled", true);

        $("#email").attr("placeholder", email);

        $("#name").attr("placeholder", name);

        $("#job").val(job);

        $("#spvid").val(spvid);
        $("#spvid").attr("disabled", true);

        $("#dept").val(dept);
        $("#dept").attr("disabled", true);

        $("#spvemail").attr("placeholder", spvemail);

        if (type == "Vendor") {
            $("#ddlsuperiorname").attr("disabled", false);
            $("#name").attr("disabled", false);
            $("#job").attr("disabled", false);
            GetSuperiornameDDL(id);
        } else {

            text += '<Option class="dropdown-item" value = "' + spvname + '" selected >' + spvname;

            $("#ddlsuperiorname").empty();
            $("#ddlsuperiorname").append(text);
            $("#ddlsuperiorname").select();


            $("#ddlsuperiorname").attr("disabled", true);
            $("#name").attr("disabled", true);
            $("#spvemail").attr("disabled", true);
            $("#job").attr("disabled", true);

        }

        $("#Update").click(function () {



            if (!document.getElementById('email').value) {
                email = email;
            } else {
                email = document.getElementById('email').value;
            }

            if (!document.getElementById('name').value) {
                name = name;
            } else {
                name = document.getElementById('name').value;
            }

            if (!document.getElementById('job').value) {
                job = job;
            } else {
                job = document.getElementById('job').value;
            }

            if (!document.getElementById('spvid').value) {
                spvid = spvid;
            } else {
                spvid = document.getElementById('spvid').value;
            }

            if (!document.getElementById('ddlsuperiorname').value) {
                spvname = spvname;
            } else {
                spvname = document.getElementById('ddlsuperiorname').value;
            }

            if (!document.getElementById('dept').value) {
                dept = dept;
            } else {
                dept = document.getElementById('dept').value;
            }

            if (!document.getElementById('spvemail').value) {
                spvemail = spvemail;
            } else {
                spvemail = document.getElementById('spvemail').value;
            }

            if (!document.getElementById('role').value) {
                role = role;
            } else {
                role = document.getElementById('role').value;
            }

            if (!document.getElementById('penyimpangan').value) {
                penyimpangan = "NULL";
            } else {
                //penyimpangan = $('#penyimpangan').select2("val");
                penyimpangan = $('#penyimpangan').val();
                penyimpangan = penyimpangan.toString();
            }

            

            Update(id, username, email, name, job, spvid, spvname, dept, spvemail, role, penyimpangan);

        
        });

        //    const { value: formValues } = Swal.fire({
        //        title: 'Update Credential : <i><b>' + name + '</b></i>',
        //        html:

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="username" class="col-form-label">' +
        //            'Username :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="username" type="text" placeholder="' + username + '" style="display:block;" name="username"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="email" class="col-form-label">' +
        //            'Email :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="email" type="text" placeholder="' + email + '" style="display:block;" name="email"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="name" class="col-form-label">' +
        //            'Name :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="name" type="text" placeholder="' + name + '" style="display:block;" name="name"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="job" class="col-form-label">' +
        //            'Job Name :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="job" type="text" placeholder="' + job + '" style="display:block;" name="job"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="spvid" class="col-form-label">' +
        //            'Superior ID :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="spvid" type="text" placeholder="' + spvid + '" style="display:block;" name="spvid"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="spvname" class="col-form-label">' +
        //            'Superior Name :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="spvname" type="text" placeholder="' + spvname + '" style="display:block;" name="spvid"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="dept" class="col-form-label">' +
        //            'Department :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="dept" type="text" placeholder="' + dept + '" style="display:block;" name="dept"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="spvemail" class="col-form-label">' +
        //            'Superior Email :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<input class="form-control" id="spvemail" type="text" placeholder="' + spvemail + '" style="display:block;" name="spvemail"/>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="role" class="col-form-label">' +
        //            'Deviation Role :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<select id="role" class="form-control">' +
        //            '<option value="" class="dropdown-header" selected>Select Role</option>' +
        //            '</select>' +
        //            '</div>' +
        //            '</div>' +

        //            '<div class="row form-group">' +
        //            '<div class="col-lg-4 col-form-label" style="text-align:right;">' +
        //            '<label for="penyimpangan" class="col-form-label">' +
        //            'Kategori Penyimpangan :' +
        //            '</label>' +
        //            '</div>' +
        //            '<div class="col-lg-6">' +
        //            '<select id="penyimpangan" class="form-control">' +
        //            '<option value="" class="dropdown-header" selected>Kategori Penyimpangan</option>' +
        //            '</select>' +
        //            '</div>' +
        //            '</div>' ,

        //        focusConfirm: false,
        //        showCancelButton: true,
        //        icon: 'warning',
        //        width: 1000,
        //        confirmButtonText: 'Yes, Update!',
        //        footer: '<p style="color:red;">Data Kosong Tidak Akan Berubah!</p>',
        //        preConfirm: () => {

        //            // VALIDATION THEN UPDATE DATA

        //            usernamex = document.getElementById('username').value;

        //            // IF NULL, THEN USE PREVIOUS DATA
        //            if (!document.getElementById('email').value) {
        //                email = email;
        //            } else {
        //                email = document.getElementById('email').value;
        //            }

        //            if (!document.getElementById('name').value) {
        //                name = name;
        //            } else {
        //                name = document.getElementById('name').value;
        //            }

        //            if (!document.getElementById('job').value) {
        //                job = job;
        //            } else {
        //                job = document.getElementById('job').value;
        //            }

        //            if (!document.getElementById('spvid').value) {
        //                spvid = spvid;
        //            } else {
        //                spvid = document.getElementById('spvid').value;
        //            }

        //            if (!document.getElementById('spvname').value) {
        //                spvname = spvname;
        //            } else {
        //                spvname = document.getElementById('spvname').value;
        //            }

        //            if (!document.getElementById('dept').value) {
        //                dept = dept;
        //            } else {
        //                dept = document.getElementById('dept').value;
        //            }

        //            if (!document.getElementById('spvemail').value) {
        //                spvemail = spvemail;
        //            } else {
        //                spvemail = document.getElementById('spvemail').value;
        //            }

        //            if (!document.getElementById('role').value) {
        //                role = role;
        //            } else {
        //                role = document.getElementById('role').value;
        //            }

        //            if (!document.getElementById('penyimpangan').value) {
        //                penyimpangan = "NULL";
        //            } else {
        //                penyimpangan = document.getElementById('penyimpangan').value;
        //            }

        //            // CHECK WHETHER USERNAME IS NULL
        //            if (!usernamex) {
        //                Swal.fire({
        //                    icon: 'error',
        //                    title: 'Oops...',
        //                    text: 'Username Kosong'

        //                })
        //                return;
        //            // CHECK USERNAME AVAILABILITY
        //            } else if (usernamex != username) {

        //                var retval = "retval";
        //                var dto = {
        //                    Username: usernamex
        //                }

        //                $.when(
        //                    $.ajax({
        //                    url: '../CMS/CMS_CheckUsername',
        //                    type: 'post',
        //                    data: JSON.stringify(dto),
        //                    dataType: 'json',
        //                    contentType: 'application/json; charset=utf-8',
        //                    success: function (data) {

        //                        if (data == "Username Exists") {

        //                            retval = "ga ok";

        //                        }

        //                    },
        //                    error: function (ex) {
        //                        alert(JSON.stringify('Check Username: ' + ex));
        //                    }

        //                    })
        //                ).then(function () {
        //                    alert(retval);
        //                    if (retval = "retval") {
        //                        return;
        //                    } else if(retval = "ga ok"){
        //                        Swal.fire({
        //                            icon: 'error',
        //                            title: 'Oops...',
        //                            text: 'Username Sudah Ada'

        //                        });
        //                    }
        //                });


        //            }

        //            Update(id, usernamex, email, name, job, spvid, spvname, dept, spvemail, role, penyimpangan);

        //        }
        //    })

        //    if (formValues) {
        //        Swal.fire(JSON.stringify(formValues))
        //    }
    }


    function Update(id, username, email, name, job, spvid, spvname, dept, spvemail, role, penyimpangan) {


        var dto = {
            empid: id,
            username: username,
            email: email,
            empname: name,
            jobttlname: job,
            superiorid: spvid,
            superiorname: spvname,
            orggroupname: dept,
            emailsuperior: spvemail,
            role: role,
            KategoriPenyimpangan: penyimpangan
        }

        console.log(dto);

        $.ajax({
            url: "../CMS/CMS_UpdateEntry",
            type: "post",
            data: JSON.stringify(dto),
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: 'Update user: ' + name + ', Success!'
                });

                LoadUser();
            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }



    function Delete(button) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {

                var row = $(button).closest("TR");
                var empid = $("TD", row).eq(1).html();

                var dto = {
                    empid: empid
                }

                $.ajax({
                    url: "../CMS/CMS_DeleteEntry",
                    type: "post",
                    data: JSON.stringify(dto),
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: function (data) {
                        LoadUser();
                        Swal.fire(
                            'Deleted!',
                            'Your file has been deleted.',
                            'success'
                        )
                    },
                    error: function (ex) {
                        alert(JSON.stringify(ex));
                    }
                });



            }
        })
    }

    function LoadUser() {
        $.ajax({
            url: "../CMS/CMS_LoadUser",
            type: "post",
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {
                var trHTML = '';
                var trav = 0;
                var Count = data.length;
                for (trav = 0; trav < Count; trav++) {
                    var no = trav + 1;
                    trHTML += '<tr><td hidden="hidden">' + no + '</td>' +
                        '<td>' + data[trav].empid + '</td>' +
                        '<td>' + data[trav].username + '</td>' +
                        '<td>' + data[trav].email + '</td>' +
                        '<td>' + data[trav].empname + '</td>' +
                        '<td>' + data[trav].jobttlname + '</td>' +
                        '<td>' + data[trav].superiorid + '</td>' +
                        '<td>' + data[trav].superiorname + '</td>' +
                        '<td>' + data[trav].orggroupname + '</td>' +
                        '<td>' + data[trav].emailsuperior + '</td>' +
                        '<td>' + data[trav].role_deviation + '</td>' +
                        '<td>' + data[trav].kategori_penyimpangan + '</td>' +
                        '<td><input type="button" id="Edit" value="Edit" onclick="Edit(this)" class="btn btn-success" style="width:40px;" data-toggle="modal" data-target=".bd-example-modal-lg"/> <input type="button" id="Delete" value="Delete" onclick=Delete(this) class="btn btn-danger" style="width:40px;"/></td>';

                    if (data[trav].FLAG_TYPE == 'HRIS') {
                        trHTML +=
                            '<td> - </td>';

                    } else {
                        trHTML +=
                            '<td><input type="button" id="Reset" value="Reset" onclick=Reset(this) class="btn btn-info" style="width:40px;"/></td>';
                    }

                    trHTML += '<td hidden="hidden">' + data[trav].FLAG_TYPE + '</td>';
                }


                $('#datatableuser').DataTable().destroy();
                $('#usertable').empty();
                $('#usertable').append(trHTML);
                $('#datatableuser').DataTable();


            },
            error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function GetRole() {
        $.ajax({
            url: "../CMS/CMS_GetRole",
            type: "post",
            dataType: "json",
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                var trhtml = "";
                var trav = 0;
                var count = data.length;

                trhtml += '<option selected class="dropdown-header">* Select Role *</option>';
                if (count > 0) {
                    for (trav = 0; trav < count; trav++) {
                        trhtml +=
                            '<option class="dropdown-item" value = "' + data[trav].rolename + '">' + data[trav].rolename + '</option>';
                    }
                }

                $("#role").empty();
                $("#role").append(trhtml);
                $("#role").select();
            }, error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function GetKategoriPenyimpangan(t_username) {

        var dto = {
            Username: t_username
        }

        $.ajax({
            url: "../CMS/CMS_GetKategoriPenyimpangan",
            type: "post",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                var trhtml = "";
                var trav = 0;
                var count = data.length;
                trhtml += '<option disabled class="dropdown-header">* Select Kategori Penyimpangan *</option>';

                if (count > 0) {
                    for (trav = 0; trav < count; trav++) {

                        if (data[trav].role_deviation == 'Coordinator_QA' || data[trav].role_deviation == 'Coordinator_QS') {
                            trhtml += '<Option value = "' + data[trav].DDL_CODE + '" > ' + data[trav].DDL_DESCRIPTION;
                        } else {
                            trhtml += '<Option class="dropdown-item" selected value = "-" > - ';
                            break;
                        }


                    }
                }

                $("#penyimpangan").empty();
                $("#penyimpangan").append(trhtml);
                $("#penyimpangan").select2({
                    placeholder: "Kategori Penyimpangan",
                    multiple: true
                    
                });
            }, error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

    function GetRoleEdit(t_username) {

        var dto = {
            Username: t_username
        }

        $.ajax({
            url: "../CMS/CMS_GetRole_Param",
            type: "post",
            dataType: "json",
            data: JSON.stringify(dto),
            contentType: "application/json;charset=utf-8",
            success: function (data) {

                var trhtml = "";
                var trav = 0;
                var count = data.length;

                trhtml += '<option disabled class="dropdown-header">Select Role</option>';

                if (count > 0) {
                    for (trav = 0; trav < count; trav++) {

                        if (data[trav].rolename == '' || data[trav].DDL_TRUE == null) {
                            trhtml += '<Option class="dropdown-item" selected value = "" > - ';
                            break;
                        }

                        if (data[trav].DDL_TRUE == data[trav].rolename) {
                            trhtml += '<Option class="dropdown-item" selected value = "' + data[trav].rolename + '" > ' + data[trav].rolename;
                        } else {
                            trhtml += '<Option class="dropdown-item" value = "' + data[trav].rolename + '" > ' + data[trav].rolename;
                        }


                    }
                }

                $("#role").empty();
                $("#role").append(trhtml);
                $("#role").select();
            }, error: function (ex) {
                alert(JSON.stringify(ex));
            }
        });
    }

</script>

